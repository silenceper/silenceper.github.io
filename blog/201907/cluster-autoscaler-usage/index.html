<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹ | silenceper</title>
        <meta name="Description" content="CA ç»„ä»¶å¯ä»¥å®ç°é›†ç¾¤èŠ‚ç‚¹çš„è‡ªåŠ¨å¢åˆ ï¼Œå…³äºåŸºæœ¬ä½¿ç”¨ä»¥åŠåŸç†éƒ¨åˆ†ä»‹ç»"><meta property="og:title" content="Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹" />
<meta property="og:description" content="CA ç»„ä»¶å¯ä»¥å®ç°é›†ç¾¤èŠ‚ç‚¹çš„è‡ªåŠ¨å¢åˆ ï¼Œå…³äºåŸºæœ¬ä½¿ç”¨ä»¥åŠåŸç†éƒ¨åˆ†ä»‹ç»" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/201907/cluster-autoscaler-usage/" />
<meta property="article:published_time" content="2019-07-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-02-22T13:28:27+08:00" /><meta property="og:site_name" content="silenceper" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹"/>
<meta name="twitter:description" content="CA ç»„ä»¶å¯ä»¥å®ç°é›†ç¾¤èŠ‚ç‚¹çš„è‡ªåŠ¨å¢åˆ ï¼Œå…³äºåŸºæœ¬ä½¿ç”¨ä»¥åŠåŸç†éƒ¨åˆ†ä»‹ç»"/>
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-TileColor" content="#da532c">
<link rel="canonical" href="/blog/201907/cluster-autoscaler-usage/" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="prev" href="/blog/201810/calico-in-k8s/" /><link rel="next" href="/blog/201910/kubernetes-log/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><meta name="google-site-verification" content="VJ4lE3d3A73DNoyxuuXL_Cuu6MEErPtKXqfAv69pr6E" /><meta name="baidu-site-verification" content="k061nqJczY" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/blog\/201907\/cluster-autoscaler-usage\/"
        },"image": {
                "@type": "ImageObject",
                "url": "\/img\/silenceoer-avatar.jpg",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "k8s, ca","wordcount":  3126 ,
        "url": "\/blog\/201907\/cluster-autoscaler-usage\/","datePublished": "2019-07-02T00:00:00\x2b00:00","dateModified": "2020-02-22T13:28:27\x2b08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
                "@type": "Organization",
                "name": "silenceper",
                "logo": {
                "@type": "ImageObject",
                "url": "\/img\/silenceper-avatar.jpg",
                "width":  127 ,
                "height":  40 
                }
            },"description": "CA ç»„ä»¶å¯ä»¥å®ç°é›†ç¾¤èŠ‚ç‚¹çš„è‡ªåŠ¨å¢åˆ ï¼Œå…³äºåŸºæœ¬ä½¿ç”¨ä»¥åŠåŸç†éƒ¨åˆ†ä»‹ç»"
    }
    </script></head>
    <body><script>
            if (!window.localStorage || !window.localStorage.getItem('theme')) {window.isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;} else {
                window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            }
            window.isDark && document.body.classList.add('dark-theme');
        </script><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title animated bounceIn">
            <a href="/">silenceper</a>
        </div>
        <div class="menu"><a class="menu-item" href="/posts/">æ–‡ç« </a><a class="menu-item" href="/tags/">æ ‡ç­¾</a><a class="menu-item" href="/categories/">åˆ†ç±»</a><a class="menu-item" href="/about/">å…³äº</a><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-rotate-180 fa-fw"></i>
            </a>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-wrapper">
        <div class="header-container">
            <div class="header-title animated bounceIn">
                <a href="/">silenceper</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="/about/" title="">å…³äº</a><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-rotate-180 fa-fw"></i>
            </a>
        </div>
    </div>
</header>

<script>
    window.desktopHeaderMode = "fixed";
    window.mobileHeaderMode = "auto";
</script>
<main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animated flipInX">Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author">
                    <a class="author" href="/" rel="author" target="_blank">
                        <i class="fas fa-user-circle fa-fw"></i>silenceper
                    </a>
                </span>&nbsp;<span class="post-category">æ”¶å½•äº&nbsp;
                            <span>
                                <a href="/categories/tech">
                                    <i class="far fa-folder fa-fw"></i>Tech
                                </a>
                            </span></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-07-02>2019-07-02</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>çº¦ 3126 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>é¢„è®¡é˜…è¯» 7 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="toc" id="toc-auto">
                <h2 class="toc-title">ç›®å½•</h2>
                <div class="toc-content" id="toc-content-auto"></div>
            </div>
            <div class="toc" id="toc-static">
                <details>
                    <summary>
                        <div class="toc-title">
                            <span>ç›®å½•</span>
                            <span><i class="details icon fas fa-angle-down"></i></span>
                        </div>
                    </summary>
                    <div class="toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#éƒ¨ç½²">éƒ¨ç½²</a></li>
    <li><a href="#å·¥ä½œåŸç†">å·¥ä½œåŸç†</a>
      <ul>
        <li><a href="#æ‰©å®¹">æ‰©å®¹</a></li>
        <li><a href="#ç¼©å®¹">ç¼©å®¹</a></li>
      </ul>
    </li>
    <li><a href="#å®ç°cluster-provider">å®ç°Cluster Provider</a></li>
  </ul>
</nav></div>
                </details>
            </div><div class="content"><p>Cluster AutoScaler æ˜¯ä¸€ä¸ªè‡ªåŠ¨æ‰©å±•å’Œæ”¶ç¼© Kubernetes é›†ç¾¤ Node çš„æ‰©å±•ã€‚å½“é›†ç¾¤å®¹é‡ä¸è¶³æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å» Cloud Provider ï¼ˆæ”¯æŒ GCEã€GKE å’Œ AWSï¼‰åˆ›å»ºæ–°çš„ Nodeï¼Œè€Œåœ¨ Node é•¿æ—¶é—´èµ„æºåˆ©ç”¨ç‡å¾ˆä½æ—¶è‡ªåŠ¨å°†å…¶åˆ é™¤ä»¥èŠ‚çœå¼€æ”¯ã€‚</p>
<p>åœ¨Kubernetesä¸­å…³äºå¼¹æ€§ä¼¸ç¼©ä¸»è¦æœ‰ä¸‰ç§æ ¼å¼ï¼š</p>
<ul>
<li><strong>HPA</strong>ï¼šHorizontal Pod Autoscalingå¯ä»¥æ ¹æ®CPUåˆ©ç”¨ç‡è‡ªåŠ¨ä¼¸ç¼©ä¸€ä¸ªReplication Controllerã€Deployment æˆ–è€…Replica Setä¸­çš„Podæ•°é‡</li>
<li><strong>VPA</strong>ï¼šVertical Pod Autoscalerï¼ˆVPAï¼‰ä½¿ç”¨æˆ·æ— éœ€ä¸ºå…¶podsä¸­çš„å®¹å™¨è®¾ç½®æœ€æ–°çš„èµ„æºrequestã€‚é…ç½®åï¼Œå®ƒå°†æ ¹æ®ä½¿ç”¨æƒ…å†µè‡ªåŠ¨è®¾ç½®requestï¼Œä»è€Œå…è®¸åœ¨èŠ‚ç‚¹ä¸Šè¿›è¡Œé€‚å½“çš„è°ƒåº¦ï¼Œä»¥ä¾¿ä¸ºæ¯ä¸ªpodæä¾›é€‚å½“çš„èµ„æºé‡ã€‚</li>
<li><strong>CA</strong>ï¼šè‡ªåŠ¨ä¼¸ç¼©NODEèŠ‚ç‚¹</li>
</ul>
<h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>
<p>Cluster Autoscalerä»£ç åœ°å€ï¼š<a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler" target="_blank" rel="noopener noreffer">https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler</a>
</p>
<p>CA æä¾›äº†<a href="https://github.com/kubernetes/autoscaler/blob/7cfa98b4ca308fbede1a2f1054ef3f00daf560dd/cluster-autoscaler/cloudprovider/cloud_provider.go#L31" target="_blank" rel="noopener noreffer">Cloud Provider</a>
æ¥å£ä¾›å„ä¸ªäº‘å‚å•†æ¥å…¥ï¼Œä¸»è¦æ˜¯é’ˆå¯¹å‚å•†è‡ªå·±çš„APIï¼Œåº”å¯¹èŠ‚ç‚¹æ·»åŠ ä»¥åŠåˆ é™¤çš„è¯·æ±‚ã€‚</p>
<p>ç›®å‰äº‘å‚å•†çš„ECSäº§å“éƒ½ä¼šæœ‰æ‰©ç¼©å®¹çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚é˜¿é‡Œäº‘ESSï¼Œå°±æ˜¯CAä¸­ä¼¸ç¼©ç»„çš„æ¦‚å¿µï¼‰ï¼ŒCAå°±å¯ä»¥ç»“åˆESSå®Œæˆé›†ç¾¤çš„æ‰©ç¼©å®¹åŠŸèƒ½ã€‚</p>
<p>å„å¤§å‚å•†èŠ‚ç‚¹æ‰©ç¼©å®¹å®‰è£…ï¼š</p>
<ul>
<li>GCE: <a href="https://kubernetes.io/docs/concepts/cluster-administration/cluster-management/" target="_blank" rel="noopener noreffer">https://kubernetes.io/docs/concepts/cluster-administration/cluster-management/</a>
</li>
<li>GKE: <a href="https://cloud.google.com/container-engine/docs/cluster-autoscaler" target="_blank" rel="noopener noreffer">https://cloud.google.com/container-engine/docs/cluster-autoscaler</a>
</li>
<li>AWS: <a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/aws/README.md" target="_blank" rel="noopener noreffer">https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/aws/README.md</a>
</li>
<li>Azure: <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler/cloudprovider/azure" target="_blank" rel="noopener noreffer">https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler/cloudprovider/azure</a>
</li>
<li>alicloudï¼š<a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/alicloud/README.md" target="_blank" rel="noopener noreffer">https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/alicloud/README.md</a>
</li>
<li>baiducloudï¼š<a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/baiducloud/README.md" target="_blank" rel="noopener noreffer">https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/baiducloud/README.md</a>
</li>
</ul>
<p>ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼Œå…·ä½“å®‰è£…å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://yq.aliyun.com/articles/392170" target="_blank" rel="noopener noreffer">é˜¿é‡Œäº‘ä¸Šå¼¹æ€§ä¼¸ç¼©kubernetesé›†ç¾¤ - autoscaler
</a>
</p>
<p>å…¶ä¸­å…³é”®yamlæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: cluster-autoscaler
  namespace: kube-system
  labels:
    app: cluster-autoscaler
spec:
  replicas: 1
  selector:
    matchLabels:
      app: cluster-autoscaler
  template:
    metadata:
      labels:
        app: cluster-autoscaler
    spec:
      serviceAccountName: admin
      containers:
        - image: registry.cn-hangzhou.aliyuncs.com/google-containers/cluster-autoscaler:v1.1.0
          name: cluster-autoscaler
          resources:
            limits:
              cpu: 100m
              memory: 300Mi
            requests:
              cpu: 100m
              memory: 300Mi
          command:
            - ./cluster-autoscaler
            - --v=4
            - --stderrthreshold=info
            - --cloud-provider=alicloud
            - --skip-nodes-with-local-storage=false
            - --nodes=1ğŸ’¯${AUTO_SCALER_GROUP}
          env:
          - name: ACCESS_KEY_ID
            valueFrom:
              secretKeyRef:
                name: cloud-config
                key: access-key-id
          - name: ACCESS_KEY_SECRET
            valueFrom:
              secretKeyRef:
                name: cloud-config
                key: access-key-secret
          imagePullPolicy: &#34;Always&#34;
</code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ <code>--nodes=1ğŸ’¯${AUTO_SCALER_GROUP}</code>å‚æ•°ï¼Œè¡¨ç¤ºæ‰©å®¹æœ€å¤§100ä¸ªï¼Œç¼©å®¹æœ€å°1ä¸ªèŠ‚ç‚¹ï¼Œåé¢<code>${AUTO_SCALER_GROUP}</code>è¡¨ç¤ºä¼¸ç¼©ç»„ID</p>
<h2 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h2>
<h3 id="æ‰©å®¹">æ‰©å®¹</h3>
<p>CAä¼šå®šæœŸ(é»˜è®¤10s,é€šè¿‡å‚æ•°<code>--scan-interval</code>è®¾ç½®)æ£€æµ‹å½“å‰é›†ç¾¤çŠ¶æ€ä¸‹æ˜¯å¦å­˜åœ¨pendingçš„podï¼Œç„¶åç»è¿‡è®¡ç®—ï¼Œåˆ¤æ–­éœ€è¦æ‰©å®¹å‡ ä¸ªèŠ‚ç‚¹ï¼Œæœ€ç»ˆä»node groupä¸­è¿›è¡ŒèŠ‚ç‚¹çš„æ‰©å®¹ï¼š</p>
<p>Node Group å°±å¯¹åº”ä¼¸ç¼©ç»„çš„æ¦‚å¿µï¼Œå¯ä»¥æ”¯æŒé…ç½®æ”¯æŒå¤šä¸ªä¼¸ç¼©ç»„ï¼Œé€šè¿‡ç­–ç•¥æ¥è¿›è¡Œé€‰æ‹©ï¼Œç›®å‰æ”¯æŒçš„ç­–ç•¥ä¸ºï¼š</p>
<ul>
<li>randomï¼šéšæœºé€‰æ‹©</li>
<li>most-podsï¼šé€‰æ‹©èƒ½å¤Ÿåˆ›å»ºpodæœ€å¤šçš„Node Group</li>
<li>least-wasteï¼šä»¥æœ€å°æµªè´¹åŸåˆ™é€‰æ‹©ï¼Œå³é€‰æ‹©æœ‰æœ€å°‘å¯ç”¨èµ„æºçš„ Node Group</li>
<li>priceï¼šæ ¹æ®ä¸»æœºçš„ä»·æ ¼é€‰æ‹©ï¼Œé€‰æ‹©æœ€ä¾¿å®œçš„</li>
<li>priorityï¼šæ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œé€‰æ‹©ï¼Œé€šè¿‡é…ç½®<code>cluster-autoscaler-priority-expander</code> configMapï¼Œå…·ä½“å‚è€ƒï¼š<a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler/expander/priority" target="_blank" rel="noopener noreffer">https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler/expander/priority</a>
</li>
</ul>
<h3 id="ç¼©å®¹">ç¼©å®¹</h3>
<p>é›†ç¾¤ç¼©å®¹å…¶å®æ˜¯ä¸€ä¸ªå¯é€‰çš„é€‰é¡¹ï¼Œé€šè¿‡å‚æ•°<code>--scale-down-enabled</code>æ§åˆ¶æ˜¯å¦å¼€å¯ç¼©å®¹ã€‚</p>
<p>CAå®šæœŸä¼šæ£€æµ‹é›†ç¾¤çŠ¶æ€ï¼Œåˆ¤æ–­å½“å‰é›†ç¾¤çŠ¶æ€ä¸‹ï¼Œå“ªäº›èŠ‚ç‚¹èµ„æºåˆ©ç”¨ç‡å°äº50%(é€šè¿‡å‚æ•°<code>--scale-down-utilization-threshold</code>æ§åˆ¶)ã€‚</p>
<p>èµ„æºåˆ©ç”¨ç‡è®¡ç®—æ˜¯é€šè¿‡åˆ¤æ–­é›†ç¾¤cpuï¼Œmem ä¸­requestå€¼å ç”¨ç‡è®¡ç®—çš„ï¼Œåªè¦æœ‰ä¸€ä¸ªæŒ‡æ ‡è¶…äº†å°±å¯èƒ½ä¼šå‡ºå‘ç¼©å®¹ï¼Œä¹‹æ‰€ä»¥è¯´æ˜¯å¯èƒ½ä¼šè§¦å‘æ‰©å®¹ï¼Œæ˜¯å› ä¸ºè¦ä¿è¯è¢«é©±é€èŠ‚ç‚¹ä¸Šçš„PODèƒ½å¤Ÿæ­£ç¡®è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚</p>
<p><strong>å“ªäº›NODEä¸ä¼šç¼©å®¹ï¼š</strong></p>
<ul>
<li>å½“æ‚¨è®¾ç½®äº†ä¸¥æ ¼çš„ PodDisruptionBudget çš„ Pod ä¸æ»¡è¶³ PDB æ—¶ï¼Œä¸ä¼šç¼©å®¹ã€‚</li>
<li>Kube-system ä¸‹çš„ Podã€‚é€šè¿‡å‚æ•°<code>--skip-nodes-with-system-pods</code>æ§åˆ¶</li>
<li>èŠ‚ç‚¹ä¸Šæœ‰é deploymentï¼Œreplica setï¼Œjobï¼Œstateful set ç­‰æ§åˆ¶å™¨åˆ›å»ºçš„ Podã€‚</li>
<li>Pod æœ‰æœ¬åœ°å­˜å‚¨ã€‚é€šè¿‡å‚æ•°<code>--skip-nodes-with-local-storage</code>æ§åˆ¶</li>
<li>Pod ä¸èƒ½è¢«è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚èµ„æºä¸æ»¡è¶³ç­‰</li>
</ul>
<h2 id="å®ç°cluster-provider">å®ç°Cluster Provider</h2>
<p>å¦‚æœä½ ä½¿ç”¨çš„ä»¥ä¸Šä¸»æµçš„å‡ ä¸ªäº‘å‚å•†çš„ä¸»æœºèµ„æº/k8sé›†ç¾¤ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„CAç‰ˆæœ¬ï¼Œåªéœ€è¦é€šè¿‡å‚æ•°<code>--cloud-provider</code>æ§åˆ¶æ¥è‡ªå“ªä¸ªäº‘å‚å•†å°±å¯ä»¥ã€‚</p>
<p>å¦‚æœæƒ³è¦å¯¹æ¥è‡ªå·±çš„IaaSå±‚ï¼Œåªéœ€è¦å®ç°å…¶ä¸­çš„æ¥å£å°±å¯ä»¥äº†ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// CloudProvider contains configuration info and functions for interacting with
// cloud provider (GCE, AWS, etc).
type CloudProvider interface {Marcin Wielgus, 3 years ago: â€¢ Cluster-autoscaler: cloud provider interface
	// Name returns name of the cloud provider.
	Name() string

	// NodeGroups returns all node groups configured for this cloud provider.
	//è¿”å›æ‰€æœ‰ä¼¸ç¼©ç»„
	NodeGroups() []NodeGroup

	// NodeGroupForNode returns the node group for the given node, nil if the node
	// should not be processed by cluster autoscaler, or non-nil error if such
	// occurred. Must be implemented.
	NodeGroupForNode(*apiv1.Node) (NodeGroup, error)

	// Pricing returns pricing model for this cloud provider or error if not available.
	// Implementation optional.
	Pricing() (PricingModel, errors.AutoscalerError)

	// GetAvailableMachineTypes get all machine types that can be requested from the cloud provider.
	// Implementation optional.
	GetAvailableMachineTypes() ([]string, error)

	// NewNodeGroup builds a theoretical node group based on the node definition provided. The node group is not automatically
	// created on the cloud provider side. The node group is not returned by NodeGroups() until it is created.
	// Implementation optional.
	NewNodeGroup(machineType string, labels map[string]string, systemLabels map[string]string,
		taints []apiv1.Taint, extraResources map[string]resource.Quantity) (NodeGroup, error)

	// GetResourceLimiter returns struct containing limits (max, min) for resources (cores, memory etc.).
	GetResourceLimiter() (*ResourceLimiter, error)

	// GPULabel returns the label added to nodes with GPU resource.
	GPULabel() string

	// GetAvailableGPUTypes return all available GPU types cloud provider supports.
	GetAvailableGPUTypes() map[string]struct{}

	// Cleanup cleans up open resources before the cloud provider is destroyed, i.e. go routines etc.
	Cleanup() error

	// Refresh is called before every main loop and can be used to dynamically update cloud provider state.
	// In particular the list of node groups returned by NodeGroups can change as a result of CloudProvider.Refresh().
	Refresh() error
}
</code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­NodeGroupæ¥å£å®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// NodeGroup contains configuration info and functions to control a set
// of nodes that have the same capacity and set of labels.
type NodeGroup interface {
	// MaxSize returns maximum size of the node group.
	MaxSize() int

	// MinSize returns minimum size of the node group.
	MinSize() int

	// TargetSize returns the current target size of the node group. It is possible that the
	// number of nodes in Kubernetes is different at the moment but should be equal
	// to Size() once everything stabilizes (new nodes finish startup and registration or
	// removed nodes are deleted completely). Implementation required.
	TargetSize() (int, error)

	// IncreaseSize increases the size of the node group. To delete a node you need
	// to explicitly name it and use DeleteNode. This function should wait until
	// node group size is updated. Implementation required.
	//æ‰©å®¹ä¼¸ç¼©ç»„
	IncreaseSize(delta int) error

	// DeleteNodes deletes nodes from this node group. Error is returned either on
	// failure or if the given node doesn&#39;t belong to this node group. This function
	// should wait until node group size is updated. Implementation required.
	//ä»ä¼¸ç¼©ç»„ä¸­åˆ é™¤èŠ‚ç‚¹
	DeleteNodes([]*apiv1.Node) error

	// DecreaseTargetSize decreases the target size of the node group. This function
	// doesn&#39;t permit to delete any existing node and can be used only to reduce the
	// request for new nodes that have not been yet fulfilled. Delta should be negative.
	// It is assumed that cloud provider will not delete the existing nodes when there
	// is an option to just decrease the target. Implementation required.
	DecreaseTargetSize(delta int) error

	// Id returns an unique identifier of the node group.
	Id() string

	// Debug returns a string containing all information regarding this node group.
	Debug() string

	// Nodes returns a list of all nodes that belong to this node group.
	// It is required that Instance objects returned by this method have Id field set.
	// Other fields are optional.
	Nodes() ([]Instance, error)

	// TemplateNodeInfo returns a schedulernodeinfo.NodeInfo structure of an empty
	// (as if just started) node. This will be used in scale-up simulations to
	// predict what would a new node look like if a node group was expanded. The returned
	// NodeInfo is expected to have a fully populated Node object, with all of the labels,
	// capacity and allocatable information as well as all pods that are started on
	// the node by default, using manifest (most likely only kube-proxy). Implementation optional.
	TemplateNodeInfo() (*schedulernodeinfo.NodeInfo, error)

	// Exist checks if the node group really exists on the cloud provider side. Allows to tell the
	// theoretical node group from the real one. Implementation required.
	Exist() bool

	// Create creates the node group on the cloud provider side. Implementation optional.
	Create() (NodeGroup, error)

	// Delete deletes the node group on the cloud provider side.
	// This will be executed only for autoprovisioned node groups, once their size drops to 0.
	// Implementation optional.
	Delete() error

	// Autoprovisioned returns true if the node group is autoprovisioned. An autoprovisioned group
	// was created by CA and can be deleted when scaled to 0.
	Autoprovisioned() bool
}

</code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­<code>IncreaseSize</code>ï¼Œ<code>IncreaseSize</code>æ‰æ˜¯å…³é”®çš„æ–¹æ³•ï¼Œåˆ†åˆ«å¯¹ç”¨æ‰©å®¹ä¼¸ç¼©ç»„å’Œå¢åŠ èŠ‚ç‚¹ã€‚</p>
<p>åœ¨è°ƒç”¨<code>IncreaseSize</code>æ¥å£åï¼Œéœ€è¦å®ŒæˆèŠ‚ç‚¹è‡ªåŠ¨æ·»åŠ è¿›é›†ç¾¤ã€‚å‚è€ƒé˜¿é‡Œäº‘æ˜¯é€šè¿‡é…ç½®shellè„šæœ¬åˆ°ä¼¸ç¼©ç»„ä¸­çš„ECSå¯åŠ¨è„šæœ¬ä¸­ï¼Œå½“ECSå¯åŠ¨ï¼Œè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰é€šè¿‡å…¶ä»–æ–¹å¼åŠ å…¥é›†ç¾¤ã€‚</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æœ¬æ–‡äº 2020-02-22 æ›´æ–°</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/blog/201907/cluster-autoscaler-usage/index.md" target="_blank">é˜…è¯»åŸå§‹æ–‡æ¡£</a>
                        </span></div>
            <div class="post-info-share"><span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="/blog/201907/cluster-autoscaler-usage/" data-title="Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹" data-hashtags="k8s,ca"><i class="fab fa-twitter fa-fw"></i>
</a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="/blog/201907/cluster-autoscaler-usage/" data-hashtag="k8s"><i class="fab fa-facebook-square fa-fw"></i>
</a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="/blog/201907/cluster-autoscaler-usage/" data-title="Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹"><i class="fab fa-weibo fa-fw"></i>
</a><a href="javascript:void(0);" title="åˆ†äº«åˆ° äººäºº" data-sharer="renren" data-url="/blog/201907/cluster-autoscaler-usage/"><i class="fab fa-renren fa-fw"></i>
</a><a href="javascript:void(0);" title="åˆ†äº«åˆ° ç™¾åº¦" data-sharer="baidu" data-url="/blog/201907/cluster-autoscaler-usage/" data-title="Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹"><i class="loveit it-baidu-fill"></i>
</a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="/blog/201907/cluster-autoscaler-usage/" data-title="Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹"><i class="fab fa-evernote fa-fw"></i>
</a></span></div>
        </div>
    </div>

    <div class="post-info-more">
        <section><span>
                        <a href="/tags/k8s">
                            <i class="fas fa-tag fa-fw"></i>k8s
                        </a>
                    </span>&nbsp;<span>
                        <a href="/tags/ca">
                            <i class="fas fa-tag fa-fw"></i>ca
                        </a>
                    </span>&nbsp;</section>
        <section>
            <span><a href="javascript:window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/201810/calico-in-k8s/" class="prev" rel="prev" title="k8sç½‘ç»œç»„ä»¶ï¼šcalico"><i class="fas fa-angle-left fa-fw"></i>k8sç½‘ç»œç»„ä»¶ï¼šcalico</a>
            <a href="/blog/201910/kubernetes-log/" class="next" rel="next" title="Kuberneteså®¹å™¨æ—¥å¿—æ”¶é›†æ–¹æ¡ˆ">Kuberneteså®¹å™¨æ—¥å¿—æ”¶é›†æ–¹æ¡ˆ<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div class="comment"><div id="gitalk"></div><script>
            document.addEventListener("DOMContentLoaded", function(event) {
                var gitalk = new Gitalk({
                    id: '2019-07-02 00:00:00 \x2b0000 UTC',
                    title: 'Cluster Autoscaler:é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹',
                    clientID: 'e708cc1fbc3e2613a24d',
                    clientSecret: 'ffa9552c4ef788a7f135fa7b9510ffc672d0b914',
                    repo: 'silenceper.github.io',
                    owner: 'silenceper',
                    admin: ['silenceper'],
                    body: decodeURI(location.href),
                });
                gitalk.render('gitalk');
            });
        </script>
        <noscript>
            Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by Gitalk.</a>
        </noscript></div>
    </article></div>
            </main><footer class="footer">
    <div class="copyright"><div class="copyright-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a>
        </div>

        <div class="copyright-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2016 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">silenceper</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer>
</div><a href="#" class="dynamic-to-top animated faster" id="dynamic-to-top">
            <span>&nbsp;</span>
        </a><script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$", right: "$", display: false },
                    { left: "$$", right: "$$", display: true },
                    { left: "\\(", right: "\\)", display: false },
                    { left: "\\[", right: "\\]", display: true },]
            });
        });
    </script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><link rel="stylesheet" href="/css/lib/iconfont/iconfont.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.2/dist/smooth-scroll.polyfills.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.1.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script src="/js/lib/sharer/sharer.min.js"></script><script src=/js/theme.min.js></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-139557989-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?fe23775b1a9ea11a6797646a56df1cc7";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script></body>
</html>
