<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>silenceper blog</title>
    <link>https://silenceper.github.io/</link>
    <description>Recent content on silenceper blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Fri, 16 Sep 2016 15:40:59 +0800</lastBuildDate>
    <atom:link href="https://silenceper.github.io/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>wechat sdk for golang: ä¸€ä¸ªç®€å•æ˜“ç”¨çš„å¾®ä¿¡sdk</title>
      <link>https://silenceper.github.io/blog/201609/wechat-sdk-for-golang-%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E6%98%93%E7%94%A8%E7%9A%84%E5%BE%AE%E4%BF%A1sdk/</link>
      <pubDate>Fri, 16 Sep 2016 15:40:59 +0800</pubDate>
      
      <guid>https://silenceper.github.io/blog/201609/wechat-sdk-for-golang-%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E6%98%93%E7%94%A8%E7%9A%84%E5%BE%AE%E4%BF%A1sdk/</guid>
      <description>&lt;p&gt;ä¸€ç›´å¾ˆæƒ³è‡ªå·±ç”¨golangå†™ä¸ªå¾®ä¿¡çš„sdkï¼Œç›®æ ‡æ˜¯ç®€å•å¥½ç”¨ï¼Œæ‰€ä»¥åˆ©ç”¨é—²æš‡æ—¶é—´ï¼ˆå‘¨æœ«ï¼Œä¸­ç§‹ğŸ˜ï¼‰ï¼Œå°±åšå‡ºæ¥ã€‚&lt;/p&gt;

&lt;p&gt;é¡¹ç›®åœ°å€:&lt;a href=&#34;https://github.com/silenceper/wechat&#34;&gt;https://github.com/silenceper/wechat&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç›®å‰å®ç°äº†æ¶ˆæ¯ç®¡ç†ï¼Œå¾®ä¿¡ç½‘é¡µæˆæƒï¼Œèœå•ç®¡ç†ï¼Œç´ æç®¡ç†å‡ ä¸ªæ¥å£ï¼Œçœ‹ä¸‹ä»–çš„åŸºæœ¬ä½¿ç”¨ï¼š&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¤„ç†æ¶ˆæ¯æ¥æ”¶ä»¥åŠå›å¤çš„ä¾‹å­ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;
//é…ç½®å¾®ä¿¡å‚æ•°
config := &amp;amp;wechat.Config{
    AppID:          &amp;quot;xxxx&amp;quot;,
    AppSecret:      &amp;quot;xxxx&amp;quot;,
    Token:          &amp;quot;xxxx&amp;quot;,
    EncodingAESKey: &amp;quot;xxxx&amp;quot;,
    Cache:          memCache
}
wc := wechat.NewWechat(config)

// ä¼ å…¥requestå’ŒresponseWriter
server := wc.GetServer(request, responseWriter)
server.SetMessageHandler(func(msg message.MixMessage) *message.Reply {

    //å›å¤æ¶ˆæ¯ï¼šæ¼”ç¤ºå›å¤ç”¨æˆ·å‘é€çš„æ¶ˆæ¯
    text := message.NewText(msg.Content)
    return &amp;amp;message.Reply{message.MsgText, text}
})

server.Serve()
server.Send()


&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>DCMP: ä¸€ä¸ªåˆ†å¸ƒå¼ç®¡ç†é…ç½®å¹³å°</title>
      <link>https://silenceper.github.io/blog/201608/dcmp-%E4%B8%80%E4%B8%AA%E5%88%86%E5%B8%83%E5%BC%8F%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE%E5%B9%B3%E5%8F%B0/</link>
      <pubDate>Tue, 02 Aug 2016 15:40:59 +0800</pubDate>
      
      <guid>https://silenceper.github.io/blog/201608/dcmp-%E4%B8%80%E4%B8%AA%E5%88%86%E5%B8%83%E5%BC%8F%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE%E5%B9%B3%E5%8F%B0/</guid>
      <description>&lt;p&gt;Distributed Configuration Management Platform&lt;/p&gt;

&lt;p&gt;æä¾›äº†ä¸€ä¸ªetcdçš„ç®¡ç†ç•Œé¢ï¼Œå¯é€šè¿‡ç•Œé¢ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼Œå€ŸåŠ©confdå¯å®ç°é…ç½®æ–‡ä»¶çš„åŒæ­¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/silenceper/dcmp/master/docs/image.png&#34; alt=&#34;dcmp image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;GITHUBï¼š&lt;a href=&#34;https://github.com/silenceper/dcmp&#34;&gt;https://github.com/silenceper/dcmp&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;APIé‡‡ç”¨çš„æ˜¯Gin Frameworkï¼Œå†™èµ·apiåº”ç”¨æ¥éå¸¸æ–¹ä¾¿ï¼Œå‰ç«¯å°è¯•äº†ä¸€ä¸‹reactã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ä¼ åˆ°Githubä¸€çœ‹ï¼Œå‘ç°cssï¼Œjsçš„ä»£ç æ¯”golangè¿˜è¦å¤š ã€‚ ğŸ˜¢&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Golang ä¸­httpåŒ…é»˜è®¤è·¯ç”±åŒ¹é…è§„åˆ™é˜…è¯»ç¬”è®°</title>
      <link>https://silenceper.github.io/blog/201605/golang-%E4%B8%ADhttp%E5%8C%85%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</link>
      <pubDate>Sat, 28 May 2016 18:00:59 +0800</pubDate>
      
      <guid>https://silenceper.github.io/blog/201605/golang-%E4%B8%ADhttp%E5%8C%85%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</guid>
      <description>

&lt;h1 id=&#34;ä¸€-æ‰§è¡Œæµç¨‹&#34;&gt;ä¸€ã€æ‰§è¡Œæµç¨‹&lt;/h1&gt;

&lt;p&gt;æ„å»ºä¸€ä¸ªç®€å•http serverï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;package main

import (
	&amp;quot;log&amp;quot;
	&amp;quot;net/http&amp;quot;
)

func main() {
	http.HandleFunc(&amp;quot;/&amp;quot;, func(w http.ResponseWriter, r *http.Request) {
		w.Write([]byte(&amp;quot;hello world&amp;quot;))
	})
	log.Fatal(http.ListenAndServe(&amp;quot;:8080&amp;quot;, nil))
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;http://127.0.0.1:8080/&lt;/code&gt; å°±å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†&lt;/p&gt;

&lt;p&gt;é€šè¿‡è·Ÿè¸ªhttp.goåŒ…ä»£ç ï¼Œå¯ä»¥å‘ç°æ‰§è¡Œæµç¨‹åŸºæœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;h4 id=&#34;1-åˆ›å»ºä¸€ä¸ª-listener-ç›‘å¬-8080-ç«¯å£&#34;&gt;1.åˆ›å»ºä¸€ä¸ª&lt;code&gt;Listener&lt;/code&gt;ç›‘å¬&lt;code&gt;8080&lt;/code&gt;ç«¯å£&lt;/h4&gt;

&lt;h4 id=&#34;2-è¿›å…¥-for-å¾ªç¯å¹¶acceptè¯·æ±‚-æ²¡æœ‰è¯·æ±‚åˆ™å¤„äºé˜»å¡çŠ¶æ€&#34;&gt;2.è¿›å…¥&lt;code&gt;for&lt;/code&gt;å¾ªç¯å¹¶Acceptè¯·æ±‚ï¼Œæ²¡æœ‰è¯·æ±‚åˆ™å¤„äºé˜»å¡çŠ¶æ€&lt;/h4&gt;

&lt;h4 id=&#34;3-æ¥æ”¶åˆ°è¯·æ±‚-å¹¶åˆ›å»ºä¸€ä¸ªconnå¯¹è±¡-æ”¾å…¥goroutineå¤„ç†-å®ç°é«˜å¹¶å‘å…³é”®&#34;&gt;3.æ¥æ”¶åˆ°è¯·æ±‚ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªconnå¯¹è±¡ï¼Œæ”¾å…¥goroutineå¤„ç†ï¼ˆå®ç°é«˜å¹¶å‘å…³é”®ï¼‰&lt;/h4&gt;

&lt;h4 id=&#34;4-è§£æè¯·æ±‚æ¥æºä¿¡æ¯è·å¾—è¯·æ±‚è·¯å¾„ç­‰é‡è¦ä¿¡æ¯&#34;&gt;4.è§£æè¯·æ±‚æ¥æºä¿¡æ¯è·å¾—è¯·æ±‚è·¯å¾„ç­‰é‡è¦ä¿¡æ¯&lt;/h4&gt;

&lt;h4 id=&#34;5-è¯·æ±‚serverhttpæ–¹æ³•-å·²ç»é€šè¿‡ä¸Šä¸€æ­¥è·å¾—äº†responsewriterå’Œrequestå¯¹è±¡&#34;&gt;5.è¯·æ±‚ServerHTTPæ–¹æ³•ï¼Œå·²ç»é€šè¿‡ä¸Šä¸€æ­¥è·å¾—äº†ResponseWriterå’ŒRequestå¯¹è±¡&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (sh serverHandler) ServeHTTP(rw ResponseWriter, req *Request) {
	//æ­¤handlerå³ä¸ºhttp.ListenAndServe ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°
	handler := sh.srv.Handler 
	if handler == nil {
		//å¦‚æœhandlerä¸ºç©ºåˆ™ä½¿ç”¨å†…éƒ¨çš„DefaultServeMux è¿›è¡Œå¤„ç†
		handler = DefaultServeMux
	}
	if req.RequestURI == &amp;quot;*&amp;quot; &amp;amp;&amp;amp; req.Method == &amp;quot;OPTIONS&amp;quot; {
		handler = globalOptionsHandler{}
	}
	//è¿™é‡Œå°±å¼€å§‹å¤„ç†httpè¯·æ±‚
	//å¦‚æœéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„muxï¼Œå°±éœ€è¦å®ç°ServeHTTPæ–¹æ³•ï¼Œå³å®ç°Handleræ¥å£ã€‚
	handler.ServeHTTP(rw, req)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;6.è¿›å…¥DefaultServeMuxä¸­çš„é€»è¾‘å°±æ˜¯æ ¹æ®è¯·æ±‚pathåœ¨mapä¸­åŒ¹é…æŸ¥æ‰¾handlerï¼Œå¹¶äº¤ç”±handlerå¤„ç†&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;httpè¯·æ±‚å¤„ç†æµç¨‹æ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒ&lt;a href=&#34;https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/03.3.md&#34;&gt;ã€ŠGo Web ç¼–ç¨‹
ã€‹3.3 Goå¦‚ä½•ä½¿å¾—Webå·¥ä½œ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;äºŒ-defaultservemux-è·¯ç”±åŒ¹é…è§„åˆ™&#34;&gt;äºŒã€DefaultServeMux è·¯ç”±åŒ¹é…è§„åˆ™&lt;/h1&gt;

&lt;p&gt;å…ˆçœ‹å‡ ä¸ªè·¯ç”±è§„åˆ™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;package main

import (
	&amp;quot;log&amp;quot;
	&amp;quot;net/http&amp;quot;
)

func main() {
	//è§„åˆ™1
	http.HandleFunc(&amp;quot;/&amp;quot;, func(w http.ResponseWriter, r *http.Request) {
		w.Write([]byte(&amp;quot;hello world&amp;quot;))
	})
	
	//è§„åˆ™2
	http.HandleFunc(&amp;quot;/path/&amp;quot;, func(w http.ResponseWriter, r *http.Request) {
		w.Write([]byte(&amp;quot;pattern path: /path/ &amp;quot;))
	})

	//è§„åˆ™3
	http.HandleFunc(&amp;quot;/path/subpath&amp;quot;, func(w http.ResponseWriter, r *http.Request) {
		w.Write([]byte(&amp;quot;pattern path: /path/subpath&amp;quot;))
	})

	log.Fatal(http.ListenAndServe(&amp;quot;:8080&amp;quot;, nil))
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æƒ…æ™¯ä¸€ï¼š&lt;/p&gt;

&lt;p&gt;è®¿é—®ï¼š&lt;code&gt;http://127.0.0.1:8080/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¿”å›ï¼š&lt;code&gt;hello world&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;æƒ…æ™¯äºŒï¼š&lt;/p&gt;

&lt;p&gt;è®¿é—®ï¼š&lt;code&gt;http://127.0.0.1:8080/path&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¿”å›ï¼š&lt;code&gt;pattern path: /path/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;æƒ…æ™¯ä¸‰ï¼š&lt;/p&gt;

&lt;p&gt;è®¿é—®ï¼š&lt;code&gt;http://127.0.0.1:8080/path/subpath/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¿”å›ï¼š&lt;code&gt;pattern path: /path/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;æƒ…æ™¯å››ï¼š&lt;/p&gt;

&lt;p&gt;è®¿é—®ï¼š&lt;code&gt;http://127.0.0.1:8080/hahaha/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¿”å›ï¼š&lt;code&gt;hello world&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å…ˆè¯´æ˜ä¸€äº›è§„åˆ™å§ï¼Œå†çœ‹ä»£ç æ˜¯æ€ä¹ˆå®ç°çš„ï¼š&lt;/p&gt;

&lt;p&gt;1.å¦‚æœåŒ¹é…è·¯å¾„ä¸­åå¸¦æœ‰&lt;code&gt;/&lt;/code&gt;ï¼Œåˆ™ä¼šè‡ªåŠ¨å¢åŠ ä¸€ä¸ªåŒ¹é…è§„åˆ™ä¸å¸¦&lt;code&gt;/&lt;/code&gt;åç¼€çš„ï¼Œå¹¶è·³è½¬è½¬åˆ°&lt;code&gt;path/&lt;/code&gt;,è§£é‡Šäº†æƒ…æ™¯äºŒçš„åœºæ™¯ï¼Œä¸ºä»€ä¹ˆåŒ¹é…åˆ°çš„&lt;code&gt;/path/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;2.æˆ‘è®¾ç½®äº†è¿™ä¹ˆå¤šè§„åˆ™ä¸ºä»€ä¹ˆè§„åˆ™ä¸€å¯ä»¥é€šç”¨åŒ¹é…æœªè®¾ç½®çš„è·¯ç”±ä¿¡æ¯ï¼Œè€Œä¸”åˆä¸å½±å“å·²ç»å­˜åœ¨è·¯ç”±ï¼Œ å†…éƒ¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ&lt;/p&gt;

&lt;h2 id=&#34;2-1-æ·»åŠ è·¯ç”±è§„åˆ™&#34;&gt;2.1 æ·»åŠ è·¯ç”±è§„åˆ™&lt;/h2&gt;

&lt;p&gt;å…ˆçœ‹ä¸¤ä¸ªstructï¼Œè¿™æ˜¯å­˜æ”¾é»˜è®¤è·¯ç”±è§„åˆ™çš„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;type ServeMux struct {
	mu    sync.RWMutex  //å¤„ç†å¹¶å‘ï¼Œå¢åŠ è¯»å†™é”
	m     map[string]muxEntry  //å­˜æ”¾è§„åˆ™mapï¼Œkeyå³ä¸ºè®¾ç½®çš„path
	hosts bool // whether any patterns contain hostnamesï¼ˆæ˜¯å¦åŒ…å«hostï¼‰
}

type muxEntry struct {
	explicit bool //æ˜¯å¦å®Œå…¨åŒ¹é…
	h        Handler//ç›¸åº”åŒ¹é…è§„åˆ™çš„handler
	pattern  string//åŒ¹é…è·¯å¾„
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é€šè¿‡è·Ÿè¸ª&lt;code&gt;http.HandleFunc&lt;/code&gt;å®šä½åˆ°å¦‚ä¸‹ä»£ç ï¼Œæ­£æ˜¯å¾€ä¸Šé¢ä¸¤ä¸ª&lt;code&gt;struct&lt;/code&gt;ä¸­å¢åŠ è§„åˆ™ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (mux *ServeMux) Handle(pattern string, handler Handler) {
	mux.mu.Lock()
	defer mux.mu.Unlock()

	if pattern == &amp;quot;&amp;quot; {
		panic(&amp;quot;http: invalid pattern &amp;quot; + pattern)
	}
	if handler == nil {
		panic(&amp;quot;http: nil handler&amp;quot;)
	}
	//å¦‚æœå·²ç»åŒ¹é…åˆ°äº†åˆ™panic
	if mux.m[pattern].explicit {
		panic(&amp;quot;http: multiple registrations for &amp;quot; + pattern)
	}
    
    //å¢åŠ ä¸€ä¸ªæ–°çš„åŒ¹é…è§„åˆ™
	mux.m[pattern] = muxEntry{explicit: true, h: handler, pattern: pattern}
	
	//æ ¹æ®pathçš„ç¬¬ä¸€ä¸ªå­—æ¯åˆ¤æ–­æ˜¯å¦æœ‰host
	if pattern[0] != &#39;/&#39; {
		mux.hosts = true
	}

	//ï¼ï¼è¿™é‡Œçœ‹æ¸…æ¥š å°±æ˜¯å®ç°äº†æƒ…æ™¯äºŒçš„æƒ…å†µ ï¼Œçœ‹åˆ¤æ–­æ¡ä»¶
	n := len(pattern)
	if n &amp;gt; 0 &amp;amp;&amp;amp; pattern[n-1] == &#39;/&#39; &amp;amp;&amp;amp; !mux.m[pattern[0:n-1]].explicit{
		// If pattern contains a host name, strip it and use remaining
		// path for redirect.
		path := pattern
		if pattern[0] != &#39;/&#39; {
			// In pattern, at least the last character is a &#39;/&#39;, so
			// strings.Index can&#39;t be -1.
			path = pattern[strings.Index(pattern, &amp;quot;/&amp;quot;):]
		}
		url := &amp;amp;url.URL{Path: path}
		mux.m[pattern[0:n-1]] = muxEntry{h: RedirectHandler(url.String(), StatusMovedPermanently), pattern: pattern}
	}
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢æœ‰ä¸ª&lt;code&gt;Helpful behavior&lt;/code&gt;çš„æ³¨é‡Šè¡Œä¸ºï¼Œå°±æ˜¯å®ç°äº†æƒ…æ™¯äºŒçš„æƒ…å†µï¼Œä»–æ˜¯åˆ¤æ–­å¦‚æœåŒ¹é…çš„è·¯å¾„ä¸­æœ€åå«æœ‰&lt;code&gt;/&lt;/code&gt;ï¼Œå¹¶ä¸”ä¹‹å‰ä¹Ÿä¸å­˜åœ¨æ·»åŠ å»é™¤åæ–œæ çš„è§„åˆ™çš„è¯ï¼Œå°±è‡ªåŠ¨ç»™ä»–å¢åŠ ä¸€ä¸ª301çš„è·³è½¬æŒ‡å‘&lt;code&gt;/path/&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;2-2-æŸ¥æ‰¾è·¯ç”±è§„åˆ™&#34;&gt;2.2 æŸ¥æ‰¾è·¯ç”±è§„åˆ™&lt;/h2&gt;

&lt;p&gt;è·¯ç”±è§„åˆ™çš„æŸ¥æ‰¾å°±æ˜¯ä»&lt;code&gt;ServeMux&lt;/code&gt;ä¸­çš„mapå»åŒ¹é…æŸ¥æ‰¾çš„,çš„åˆ°è¿™ä¸ªhandlerå¹¶æ‰§è¡Œï¼Œåªæ˜¯ä¼šæœ‰ä¸€äº›å¤„ç†æœºåˆ¶ï¼Œæ¯”å¦‚æ€ä¹ˆæ ·ç¡®ä¿è®¿é—®&lt;code&gt;/path/subpath&lt;/code&gt;çš„æ—¶å€™æ˜¯å…ˆåŒ¹é…&lt;code&gt;/path/subpath&lt;/code&gt;è€Œä¸æ˜¯åŒ¹é…&lt;code&gt;/path/&lt;/code&gt;å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œè·Ÿè¸ªåˆ°äº†&lt;code&gt;mux.match&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è¿‡ç¨‹&lt;code&gt;mux.ServerHTTP&lt;/code&gt;-&amp;gt;&lt;code&gt;mux.Handler&lt;/code&gt;-&amp;gt;&lt;code&gt;mux.handler&lt;/code&gt;-&amp;gt;&lt;code&gt;mux.match&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;func (mux *ServeMux) match(path string) (h Handler, pattern string) {
	var n = 0
	for k, v := range mux.m {
		if !pathMatch(k, path) {
			continue
		}
		//å¦‚æœåŒ¹é…åˆ°äº†ä¸€ä¸ªè§„åˆ™ï¼Œå¹¶æ²¡æœ‰é©¬ä¸Šè¿”å›handlerï¼Œè€Œä¸”ç»§ç»­åŒ¹é…å¹¶ä¸”åˆ¤æ–­pathçš„é•¿åº¦æ˜¯å¦æ˜¯æœ€é•¿çš„ï¼Œè¿™æ˜¯å…³é”®ï¼ï¼ï¼
		if h == nil || len(k) &amp;gt; n {
			n = len(k)
			h = v.h
			pattern = v.pattern
		}
	}
	return
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;1.è¿™é‡Œå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè®¾ç½®çš„ç²¾ç¡®çš„pathæ˜¯æœ€ä¼˜åŒ¹é…åˆ°çš„ï¼Œå› ä¸ºå®ƒæ˜¯æ ¹æ®pathçš„é•¿åº¦åˆ¤æ–­ã€‚
å½“ç„¶ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆ&lt;code&gt;/&lt;/code&gt;å¯ä»¥åŒ¹é…æ‰€æœ‰ï¼ˆçœ‹&lt;code&gt;pathMatch&lt;/code&gt;å‡½æ•°å°±çŸ¥é“äº†ï¼Œ&lt;code&gt;/&lt;/code&gt;æ˜¯åŒ¹é…æ‰€æœ‰çš„ï¼Œåªæ˜¯è¿™æ˜¯æœ€åæ‰è¢«åŒ¹é…æˆåŠŸï¼‰&lt;/p&gt;

&lt;p&gt;2.å¾—åˆ°äº†å¤„ç†è¯·æ±‚çš„handlerï¼Œå†è°ƒç”¨&lt;code&gt;h.ServeHTTP(w, r)&lt;/code&gt;ï¼Œå»æ‰§è¡Œç›¸åº”çš„handleræ–¹æ³•ã€‚&lt;/p&gt;

&lt;p&gt;ç­‰ä¸€ä¸‹ï¼Œhandlerä¸­å“ªé‡Œæœ‰&lt;code&gt;ServeHTTP&lt;/code&gt;è¿™ä¸ªæ–¹æ³•ï¼Ÿï¼Ÿ&lt;/p&gt;

&lt;p&gt;å› ä¸ºåœ¨è°ƒç”¨ &lt;code&gt;http.HandleFunc&lt;/code&gt;çš„æ—¶å€™å·²ç»å°†è‡ªå®šä¹‰çš„handlerå¤„ç†å‡½æ•°ï¼Œå¼ºåˆ¶è½¬ä¸º&lt;code&gt;HandlerFunc&lt;/code&gt;ç±»å‹çš„ï¼Œå°±æ‹¥æœ‰äº†&lt;code&gt;ServeHTTP&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;type HandlerFunc func(ResponseWriter, *Request)

// ServeHTTP calls f(w, r).
func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) {
	f(w, r)
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;f(w,r)&lt;/code&gt;å°±å®ç°äº†handlerçš„æ‰§è¡Œã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;è„‘å­é‡Œé¢æ¸…æ¥šï¼Œä½†çœŸåˆ°è¡¨è¿°çš„æ—¶å€™ï¼Œå‘µå‘µï¼Œå½“åšç¬”è®°å•¦ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>ä½ å¥½ï¼Œä¸–ç•Œï¼</title>
      <link>https://silenceper.github.io/blog/201605/%E4%BD%A0%E5%A5%BD%E4%B8%96%E7%95%8C/</link>
      <pubDate>Sat, 28 May 2016 15:40:59 +0800</pubDate>
      
      <guid>https://silenceper.github.io/blog/201605/%E4%BD%A0%E5%A5%BD%E4%B8%96%E7%95%8C/</guid>
      <description>&lt;p&gt;é™ä¸‹å¿ƒæ¥ï¼Œéšä¾¿å†™å†™&lt;/p&gt;

&lt;p&gt;Blogè¢«æŠ˜è…¾è¿‡å¾ˆå¤šæ¬¡ï¼Œä»aspçš„zblogåˆ°phpçš„WordPressï¼Œä¸€ç›´æ„Ÿè§‰å¾ˆç‚«ï¼Œè‡ªå·±ä¹Ÿè‡ªå®šä¹‰è¿‡ä¸»é¢˜ã€‚ä½†æ˜¯æ„Ÿè§‰è„±ç¦»äº†è‡ªå·±å»ºç«‹blogçš„åˆè¡·ï¼Œä»…ä»…åªæ˜¯æƒ³æŠŠè‡ªå·±çš„æƒ³æ³•è®°å½•ä¸‹æ¥ï¼Œæ‰€ä»¥å°±ç›´æ¥é€‰ç”¨çš„Hugo+github pagesï¼Œè¿™æ ·æœ€ç®€å•ï¼Œä¹Ÿæ›´è‡ªç„¶ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>tcp time_waitè¿æ¥æ•°è¿‡å¤šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨</title>
      <link>https://silenceper.github.io/blog/201601/tcp-time_wait%E8%BF%9E%E6%8E%A5%E6%95%B0%E8%BF%87%E5%A4%9A%E5%AF%BC%E8%87%B4%E6%9C%8D%E5%8A%A1%E4%B8%8D%E5%8F%AF%E7%94%A8/</link>
      <pubDate>Sun, 03 Jan 2016 15:40:59 +0800</pubDate>
      
      <guid>https://silenceper.github.io/blog/201601/tcp-time_wait%E8%BF%9E%E6%8E%A5%E6%95%B0%E8%BF%87%E5%A4%9A%E5%AF%BC%E8%87%B4%E6%9C%8D%E5%8A%A1%E4%B8%8D%E5%8F%AF%E7%94%A8/</guid>
      <description>

&lt;h1 id=&#34;é—®é¢˜å‡ºç°&#34;&gt;é—®é¢˜å‡ºç°ï¼š&lt;/h1&gt;

&lt;p&gt;åœ¨å…ƒæ—¦å‰å¤•ï¼Œè‡ªå·±ç»´æŠ¤çš„ä¸€ä¸ªæœåŠ¡çªç„¶åœ¨é«˜å³°æ—¶æœŸæ”¶åˆ°å¤§é‡æŠ¥è­¦ï¼Œèµ¶ç´§ç™»ä¸ŠæœåŠ¡å™¨çœ‹ä¸€ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;æœ€å¼€å§‹çš„ååº”æ˜¯memcache tcp read time out ,å› ä¸ºä¹‹å‰ä¹Ÿå‡ºç°è¿‡ç±»ä¼¼çš„è­¦å‘Šæ‰€ä»¥å¼€å§‹å°è¯•åˆ‡æ¢memcacheï¼Œä½†æ˜¯è¿ç»´åé¦ˆå·²ç»åˆ‡æ¢äº†å¥½å‡ å°è¿˜æ˜¯ä¸èµ·ä½œç”¨ã€‚&lt;/p&gt;

&lt;p&gt;åˆçœ‹åˆ°æœ‰mysql è¿æ¥ä¸ä¸ŠæŠ¥é”™ï¼Œæ€€ç–‘æœºæˆ¿å†…ç½‘æœ‰é—®é¢˜ï¼Œç„¶åæœ‰å¼€å§‹åˆ‡æ¢æœºæˆ¿åŠ æœºå™¨ï¼Œå½“æ—¶é—®é¢˜è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°è§£å†³ï¼Œè¿™ä¸‹çœŸæ™•äº†ã€‚ã€‚ã€‚ã€‚ å®Œå…¨æ’æŸ¥ä¸å‡ºä»€ä¹ˆé—®é¢˜ï¼ˆå› ä¸ºæ˜¯é«˜å³°æ—¶æœŸï¼Œtcpè¿æ¥æ•°è‡ªç„¶å¾ˆé«˜ï¼Œæ²¡æœ‰åœ¨æ„æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œè‡ªå·±é¢„ä¼°ä¸å¤Ÿï¼‰&lt;/p&gt;

&lt;p&gt;åæ¥ååº”è¿‡æ¥çœ‹åˆ°æœ‰å¥½å‡ ä¸ªæ¥å£è¯·æ±‚æ•°å¢åŠ ï¼Œå› ä¸ºå‘ç‰ˆæœ¬çš„åŸå› ï¼Œæ˜¯æ–°ç‰ˆæœ¬æ‰ä¼šè¯·æ±‚è¿™äº›æ¥å£ï¼Œæ‰€ä»¥ æˆ‘æš‚æ—¶å±è”½äº†è¿™å‡ ä¸ªå£æ¥å£é—®é¢˜å¾—åˆ°éåˆ¶ï¼ˆå¹¸å¥½æ˜¯ç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°çš„æ¥å£ï¼‰ã€‚&lt;/p&gt;

&lt;h1 id=&#34;æ’æŸ¥&#34;&gt;æ’æŸ¥ï¼š&lt;/h1&gt;

&lt;p&gt;è¿™ä¸ªé—®é¢˜å›´ç»•æˆ‘å¥½å‡ å¤©ï¼Œæˆ‘å±è”½çš„é‚£å‡ ä¸ªæ¥å£ï¼Œåå¤çœ‹äº†å¥½å‡ éï¼Œè€Œä¸”åˆå°†å…¶ä¸­çš„sqlæŸ¥è¯¢åˆ†æï¼Œå¹¶æ²¡æœ‰æ…¢è¯·æ±‚ã€‚ã€‚ã€‚  è¿™ä¸‹åˆå½»åº•æ‡µäº†ï¼Œæ²¡æœ‰å¤´ç»ªã€‚&lt;/p&gt;

&lt;p&gt;è¯´æ¥ä¹Ÿå·§ï¼Œé«˜å³°æ—¶æœŸæˆ‘ç”¨&lt;code&gt;netstat -an&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹äº†ä¸€äº›ï¼Œçœ‹åˆ°å¤§é‡tcp time_wait çš„è¿æ¥ï¼Œèµ¶ç´§Googleäº†ä¸‹ï¼Œtcp time_waitçŠ¶æ€æ˜¯åœ¨ä¸»åŠ¨å…³é—­è¿æ¥çš„ä¸€æ–¹ä¿æŒçš„ä¸€ä¸ªçŠ¶æ€ï¼ˆä¸€èˆ¬æŒ‡å®¢æˆ·ç«¯ï¼‰ï¼Œ&lt;/p&gt;

&lt;p&gt;æ€»å…±çš„è¿æ¥æ•°åœ¨è¿‘3w(ss -så¯æŸ¥)ï¼Œå…¶ä¸­æœ‰2wå¤šéƒ½æ˜¯è¿™ç§è¿æ¥ï¼Œè€Œä¸”éƒ½æ˜¯mysql è¿æ¥ï¼ˆè¿™é‡Œè¾¹æœåŠ¡å™¨ç¨‹åºå°±ç›¸å½“äºå®¢æˆ·ç«¯å»è¿æ¥mysqlæœåŠ¡å™¨ï¼‰ï¼Œåˆ°è¿™é‡Œå¿ƒé‡Œå¤§è‡´æœ‰åº•äº†ï¼ŒæŠŠæ•°æ®åº“è¿æ¥æ± åŠ ä¸Šå°±å¥½äº†ï¼ŒGolangæä¾›äº†ä¸¤ä¸ªå‡½æ•°å¯è¿›è¡Œé…ç½®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;SetMaxOpenConnsç”¨äºè®¾ç½®æœ€å¤§æ‰“å¼€çš„è¿æ¥æ•°ï¼Œé»˜è®¤å€¼ä¸º0è¡¨ç¤ºä¸é™åˆ¶ã€‚
SetMaxIdleConnsç”¨äºè®¾ç½®é—²ç½®çš„è¿æ¥æ•°ã€‚
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å› ä¸ºé¡¹ç›®æä¾›çš„ormæ˜¯æ²¡æœ‰ä¸»åŠ¨çš„å»å…³é—­æ•°æ®åº“çš„è¿æ¥çš„ï¼Œå› ä¸ºè€ƒè™‘åˆ°è¿æ¥å»ºç«‹ä»¥åŠé‡Šæ”¾ä¸­é—´çš„æ¶ˆè€—ï¼ˆæä¾›çš„æ–¹æ¡ˆæ˜¯é€šè¿‡è¿æ¥æ± æå®šï¼‰&lt;/p&gt;

&lt;p&gt;æ²¡æœ‰é…ç½®è¿æ¥æ± ï¼Œæ¯æ¬¡çš„éƒ½éœ€è¦æ–°å»ºä¸€ä¸ªè¿æ¥å¹¶è¿›è¡Œå¤„ç†ï¼Œè€Œä¸”åˆæ²¡æœ‰è¿›è¡Œå…³é—­ï¼Œè¿™æ˜¯å¯¼è‡´tcp å‡ºç°å¤§é‡time_waitçš„ä¸»è¦åŸå› ã€‚&lt;/p&gt;

&lt;h1 id=&#34;åæ€&#34;&gt;åæ€ï¼š&lt;/h1&gt;

&lt;p&gt;é—®é¢˜ç»ˆäºæ‰¾åˆ°è§£å†³ï¼Œä½†æ˜¯å›è¿‡å¤´æ¥æƒ³äº†ä¸€ä¸‹ï¼Œå…¶å®ä¸€å¼€å§‹å°±å¯ä»¥å®šä½åˆ°çš„ï¼Œåªæ˜¯å¾ˆå¤šé—®é¢˜é›†ä¸­åœ¨ä¸€èµ·å‡ºç°åè€Œè®©è‡ªå·±ä¸çŸ¥æ‰€æªï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæ˜¯æ•æ„Ÿçš„äººçš„è¯åº”è¯¥é©¬ä¸Šèƒ½å¤Ÿä»tcpçŠ¶æ€ä¸Šçœ‹å‡ºé—®é¢˜ï¼Œä¹‹åçº¿ä¸Šé‡åˆ°é—®é¢˜ï¼Œé‡è¦çš„æ˜¯å…ˆè§£å†³ï¼ˆä¸ç®¡é€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼‰ï¼Œä¹‹åå†ä¸€æ­¥æ­¥æ’æŸ¥ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>About</title>
      <link>https://silenceper.github.io/about/</link>
      <pubDate>Sat, 22 Aug 2015 06:42:21 -0700</pubDate>
      
      <guid>https://silenceper.github.io/about/</guid>
      <description>&lt;p&gt;ç¨‹åºå‘˜:PHP,Golang&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>colophon</title>
      <link>https://silenceper.github.io/colophon/</link>
      <pubDate>Sat, 22 Aug 2015 06:28:26 -0700</pubDate>
      
      <guid>https://silenceper.github.io/colophon/</guid>
      <description>&lt;p&gt;ä¸ªäººæ—¥å¿—&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Code</title>
      <link>https://silenceper.github.io/code/</link>
      <pubDate>Wed, 19 Aug 2015 20:29:37 -0700</pubDate>
      
      <guid>https://silenceper.github.io/code/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;ç©ºç™½ã€‚ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ€»æœ‰ä¸€å¤©ä¼šå¡«æ»¡çš„ã€‚ã€‚ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title></title>
      <link>https://silenceper.github.io/about-this-site/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://silenceper.github.io/about-this-site/</guid>
      <description>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;link rel=&#34;canonical&#34; href=&#34;https://silenceper.github.io/colophon&#34;/&gt;
    &lt;meta http-equiv=&#34;content-type&#34; content=&#34;text/html; charset=utf-8&#34;/&gt;
    &lt;meta http-equiv=&#34;refresh&#34; content=&#34;0;url=/colophon&#34;/&gt;
  &lt;/head&gt;
&lt;/html&gt;
</description>
    </item>
    
    <item>
      <title></title>
      <link>https://silenceper.github.io/posts/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://silenceper.github.io/posts/</guid>
      <description>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;link rel=&#34;canonical&#34; href=&#34;https://silenceper.github.io/blog&#34;/&gt;
    &lt;meta http-equiv=&#34;content-type&#34; content=&#34;text/html; charset=utf-8&#34;/&gt;
    &lt;meta http-equiv=&#34;refresh&#34; content=&#34;0;url=/blog&#34;/&gt;
  &lt;/head&gt;
&lt;/html&gt;
</description>
    </item>
    
    <item>
      <title></title>
      <link>https://silenceper.github.io/writing/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://silenceper.github.io/writing/</guid>
      <description>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;link rel=&#34;canonical&#34; href=&#34;https://silenceper.github.io/posts&#34;/&gt;
    &lt;meta http-equiv=&#34;content-type&#34; content=&#34;text/html; charset=utf-8&#34;/&gt;
    &lt;meta http-equiv=&#34;refresh&#34; content=&#34;0;url=/posts&#34;/&gt;
  &lt;/head&gt;
&lt;/html&gt;
</description>
    </item>
    
  </channel>
</rss>